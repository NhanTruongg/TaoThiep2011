<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Thiệp 20/11 - Random & Gemini</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background-color: #f0f8ff;
            font-family: 'Times New Roman', serif;
            overflow: hidden;
            padding: 15px;
        }

        .card-wrapper {
            width: 350px;
            min-height: 300px;
            position: relative;
            perspective: 1000px;
            margin: 0 auto;
            transition: height 0.3s ease;
        }

        .card {
            width: 350px;
            min-height: 180px;
            position: absolute;
            bottom: 0;
            left: 0;
            background-color: #ffffff;
            border-radius: 12px;
            padding: 25px 22px;
            box-shadow: 0 12px 28px rgba(0, 0, 0, 0.18);
            transform: translateY(100%) scale(0.9);
            transform-origin: bottom center;
            transition: all 1.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            opacity: 0;
            z-index: 1;
            backface-visibility: hidden;
        }

        .card-wrapper.active .card {
            transform: translateY(-160px) scale(1.12);
            opacity: 1;
        }

        .card-content {
            position: relative;
            display: flex;
            flex-direction: column;
            min-height: 100%;
        }

        .card-content h1 {
            color: #cc3333;
            font-size: 2.2em;
            margin-bottom: 14px;
            border-bottom: 3px double #d89648;
            padding-bottom: 6px;
            text-align: center;
            position: relative;
            z-index: 2;
        }

        .greeting-text {
            margin-top: 16px;
            font-size: 1.05em;
            line-height: 1.75;
            color: #333;
            text-align: left;
            padding: 0 5px;
            position: relative;
            z-index: 2;
        }

        .signature {
            margin-top: 24px;
            font-style: italic;
            font-weight: bold;
            color: #555;
            text-align: right;
            padding-right: 10px;
            font-size: 1.1em;
            position: relative;
            z-index: 2;
        }

        /* HOA TRANG TRÍ */
        .flower-decoration {
            position: absolute;
            width: 72px;
            height: 72px;
            opacity: 0.7;
            z-index: 1;
        }

        .flower-decoration::before,
        .flower-decoration::after {
            content: '';
            position: absolute;
            border-radius: 50%;
        }

        .flower-decoration::before {
            width: 38px;
            height: 38px;
            background-color: #ff8c00;
            box-shadow: 0 0 12px rgba(255, 140, 0, 0.5);
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        .flower-decoration::after {
            width: 46px;
            height: 18px;
            background-color: #3cb371;
            border-radius: 0 50% 50% 0;
            transform: rotate(45deg);
            top: 10px;
            left: 0;
        }

        .flower-top-left { top: 12px; left: 12px; transform: rotate(-20deg); }
        .flower-bottom-right { bottom: 12px; right: 12px; transform: rotate(160deg); }

        /* PHONG BÌ - MÀU RANDOM */
        .envelope {
            width: 350px;
            height: 250px;
            position: absolute;
            bottom: 0;
            left: 0;
            border-radius: 12px;
            z-index: 2;
            transition: all 1.5s ease;
            transform-style: preserve-3d;
        }

        .envelope::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 0;
            height: 0;
            border-left: 175px solid transparent;
            border-right: 175px solid transparent;
            border-top: 125px solid;
            transform-origin: top;
            transition: transform 0.6s ease 0.7s;
            z-index: 3;
        }

        .card-wrapper.active .envelope::before {
            transform: rotateX(180deg);
        }

        .card-wrapper.active .envelope {
            transform: translateY(320px) scale(0.75);
            opacity: 0;
            pointer-events: none;
        }

        .open-button {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 4;
            padding: 13px 26px;
            background-color: #cc3333;
            color: white;
            border: none;
            border-radius: 28px;
            cursor: pointer;
            font-weight: bold;
            font-size: 1.15em;
            box-shadow: 0 5px 12px rgba(0,0,0,0.22);
            transition: all 0.3s ease;
        }

        .open-button:hover {
            background-color: #b02a2a;
            transform: translate(-50%, -50%) scale(1.08);
        }

        .card-wrapper.active .open-button {
            opacity: 0;
            pointer-events: none;
        }
    </style>
</head>
<body>

<div class="card-wrapper" id="cardWrapper">
    <div class="card" id="card">
        <div class="card-content">
            <div class="flower-decoration flower-top-left"></div>
            <div class="flower-decoration flower-bottom-right"></div>

            <h1>Kính Chúc Mừng 20/11</h1>
            
            <p class="greeting-text" id="greetingText">
                Đang tải lời chúc...
            </p>
            
            <p class="signature">Trân trọng,<br>Học trò của Thầy/Cô</p>
        </div>
    </div>
    
    <div class="envelope" id="envelope">
        <button class="open-button" id="openCardButton">
            Mở Phong Bì
        </button>
    </div>
</div>

<script>
    // === DANH SÁCH MÀU PHONG BÌ ===
    const envelopeColors = [
        { base: '#f7b267', flap: '#d89648' }, // da
        { base: '#ffffff', flap: '#f0f0f0' }, // trắng
        { base: '#ffe4e1', flap: '#ffb6c1' }, // hồng nhạt
        { base: '#e6f3ff', flap: '#b3d9ff' }, // xanh nhạt
        { base: '#fff9e6', flap: '#ffe066' }  // vàng nhạt
    ];

    // === DANH SÁCH LỜI CHÚC TÍCH HỢP SẴN ===
    const fallbackGreetings = [
        `"Nhân ngày Nhà giáo Việt Nam, chúng con xin gửi lời tri ân sâu sắc nhất đến những người Thầy, người Cô cao quý. Sự tận tụy và nhiệt huyết của Thầy Cô chính là ngọn hải đăng soi sáng con đường tri thức cho bao thế hệ học trò.<br><br>Kính chúc Thầy Cô luôn mạnh khỏe, hạnh phúc và gặt hái thêm nhiều thành công rực rỡ trong sự nghiệp trồng người!"`,

        `"Thầy Cô là những người lái đò thầm lặng, chở bao thế hệ học trò qua dòng sông tri thức. Dù thời gian có trôi, công ơn của Thầy Cô mãi khắc sâu trong tim chúng con.<br><br>Chúc Thầy Cô ngày 20/11 thật nhiều niềm vui và sức khỏe!"`,

        `"Kính chúc Thầy Cô một ngày 20/11 tràn đầy yêu thương, được học trò tri ân, đồng nghiệp tôn trọng và gia đình hạnh phúc. Cảm ơn Thầy Cô vì đã thắp lên ngọn lửa đam mê học tập trong chúng con!"`,

        `"Thầy Cô không chỉ dạy con chữ, mà còn dạy con cách làm người. Lòng biết ơn của chúng con dành cho Thầy Cô không bao giờ phai nhạt.<br><br>Chúc Thầy Cô luôn khỏe mạnh và hạnh phúc!"`
    ];

    // === CHỌN MÀU NGẪU NHIÊN ===
    const randomColor = envelopeColors[Math.floor(Math.random() * envelopeColors.length)];
    const envelope = document.getElementById('envelope');
    envelope.style.backgroundColor = randomColor.base;
    envelope.querySelector('::before')?.style?.setProperty('border-top-color', randomColor.flap);

    // === GỌI GEMINI API ===
    async function fetchGeminiGreeting() {
        const GEMINI_API_KEY = 'YOUR_GEMINI_API_KEY_HERE'; // <-- Thay bằng key thật nếu dùng
        const prompt = `Viết một lời chúc ngắn gọn, ý nghĩa, trang trọng bằng tiếng Việt cho ngày Nhà giáo Việt Nam 20/11, dành cho Thầy Cô, có 2-3 câu, có thể xuống dòng bằng <br><br>. Không thêm dấu ngoặc kép.`;

        try {
            const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=${GEMINI_API_KEY}`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    contents: [{ role: 'user', parts: [{ text: prompt }] }]
                })
            });

            if (!response.ok) throw new Error('API error');

            const data = await response.json();
            const text = data.candidates[0].content.parts[0].text.trim();
            return text.replace(/"/g, '').replace(/\n/g, '<br><br>');
        } catch (error) {
            console.warn('Gemini API lỗi, dùng lời chúc mặc định:', error);
            return null;
        }
    }

    // === TẢI LỜI CHÚC ===
    async function loadGreeting() {
        const greetingEl = document.getElementById('greetingText');

        // Thử dùng Gemini
        let greeting = await fetchGeminiGreeting();

        // Nếu lỗi → dùng random từ danh sách
        if (!greeting) {
            greeting = fallbackGreetings[Math.floor(Math.random() * fallbackGreetings.length)];
        }

        greetingEl.innerHTML = greeting;
    }

    // === MỞ THIỆP ===
    document.getElementById('openCardButton').addEventListener('click', function() {
        const wrapper = document.getElementById('cardWrapper');
        const card = document.getElementById('card');

        if (!wrapper.classList.contains('active')) {
            wrapper.classList.add('active');

            // Tính chiều cao thực tế
            setTimeout(() => {
                const cardHeight = card.scrollHeight + 60;
                const finalHeight = cardHeight + 220;
                wrapper.style.height = finalHeight + 'px';
            }, 100);
        }
    });

    // === KHỞI CHẠY ===
    window.onload = () => {
        loadGreeting();

        // Áp dụng màu nắp phong bì (CSS ::before không hỗ trợ JS trực tiếp)
        const style = document.createElement('style');
        style.textContent = `
            #envelope::before { border-top-color: ${randomColor.flap} !important; }
            #envelope { background-color: ${randomColor.base} !important; }
        `;
        document.head.appendChild(style);
    };
</script>

</body>
</html>
